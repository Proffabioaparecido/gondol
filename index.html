<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Gondol! Game</title>
<style>
  body { font-family: sans-serif; text-align: center; background: #67ffd9; display:flex; flex-direction:column; align-items:center; justify-content:center; height:100vh; margin:0;}
  h1 { margin-bottom: 5px;}
  .info { display:flex; gap:20px; margin-bottom:10px; font-size:28px; font-weight:bold; }
  .container { display:grid; grid-template-columns:40px repeat(3,80px); grid-template-rows:40px repeat(3,80px); gap:8px; align-items:center; justify-items:center; background:#FFB347; padding:12px; border-radius:12px; }
  .header, .side { font-weight:bold; font-size:30px; }
  .cell { width:80px; height:80px; border-radius:10px; font-size:30px; display:flex; align-items:center; justify-content:center; cursor:pointer; box-shadow:2px 2px 6px rgba(0,0,0,0.2); transition:0.2s; }
  .palette { margin-top:20px; }
  .number { display:inline-block; width:50px; height:50px; background:#80ff00; color:black; border-radius:50%; line-height:50px; font-size:30px; margin:5px; cursor:pointer; transition:0.2s;}
  .number:hover { background:#32e625; transform:scale(1.1);}
  button { margin-top:20px; padding:10px 20px; font-size:20px; background:#E64A19; color:white; border:none; border-radius:8px; cursor:pointer; transition:0.2s;}
  button:hover { background:#32e625;}
  #message { margin-top:15px; font-weight:bold; font-size:18px; }
</style>
</head>
<body>

<h1>GONDOL! GAME üé≤</h1>

<div class="info">
  <div>‚è±Ô∏è Tempo: <span id="tempo">0:00</span></div>
  <div>üèÜ Recorde: <span id="recorde">--</span></div>
</div>

<div class="container" id="container"></div>
<div class="palette" id="palette"></div>
<button onclick="verificar()">Verificar</button>
<button onclick="novoDesafio()">Novo Desafio</button>
<p id="message"></p>

<script>
const container = document.getElementById('container');
const palette = document.getElementById('palette');
const message = document.getElementById('message');
const tempoEl = document.getElementById('tempo');
const recordeEl = document.getElementById('recorde');

let selectedNumber = null;
let board = Array(3).fill().map(()=>Array(3).fill(null));
let solution = Array(3).fill().map(()=>Array(3).fill(0));
let rowTargets = [0,0,0];
let colTargets = [0,0,0];
let tempo = 0;
let intervalo = null;
let jogoAtivo = false;

// carrega recorde salvo
let recorde = localStorage.getItem('recordeGondol');
if(recorde) recordeEl.textContent = recorde;

// Cron√¥metro
function iniciarTempo() {
  if(intervalo) clearInterval(intervalo);
  tempo = 0;
  tempoEl.textContent = "0:00";
  intervalo = setInterval(() => {
    tempo++;
    const min = Math.floor(tempo / 60);
    const seg = (tempo % 60).toString().padStart(2, '0');
    tempoEl.textContent = `${min}:${seg}`;
  }, 1000);
}

// Gera tabuleiro v√°lido
function gerarTabuleiro() {
  const nums = [1,2,3,4,5,6,7,8,9].sort(()=>Math.random()-0.5);
  solution = [
    nums.slice(0,3),
    nums.slice(3,6),
    nums.slice(6,9)
  ];
  rowTargets = solution.map(row => row.reduce((a,b)=>a+b,0));
  colTargets = [0,1,2].map(c => solution[0][c]+solution[1][c]+solution[2][c]);
  board = Array(3).fill().map(()=>Array(3).fill(null));
  renderBoard();
  message.textContent = '';
  iniciarTempo();
  jogoAtivo = true;
}

// Renderiza tabuleiro
function renderBoard() {
  container.innerHTML = '';
  container.appendChild(document.createElement('div')); // canto vazio
  for(let c=0;c<3;c++){
    const h = document.createElement('div');
    h.className='header';
    h.textContent=colTargets[c];
    container.appendChild(h);
  }
  for(let r=0;r<3;r++){
    const side = document.createElement('div');
    side.className='side';
    side.textContent=rowTargets[r];
    container.appendChild(side);
    for(let c=0;c<3;c++){
      const cell = document.createElement('div');
      cell.className='cell';
      cell.textContent = board[r][c]??'';
      atualizarCor(cell, r, c);
      cell.onclick = ()=>{
        if(board[r][c]===selectedNumber){ board[r][c]=null; }
        else if(selectedNumber!==null && !board.flat().includes(selectedNumber)){
          board[r][c]=selectedNumber;
        }
        renderBoard();
      };
      container.appendChild(cell);
    }
  }
}

// Atualiza cores das c√©lulas
function atualizarCor(cell, r, c) {
  const linha = board[r].filter(v=>v!=null).reduce((a,b)=>a+b,0);
  const coluna = board.map(row=>row[c]).filter(v=>v!=null).reduce((a,b)=>a+b,0);
  const linhaCompleta = board[r].every(v=>v!=null);
  const colunaCompleta = board.map(row=>row[c]).every(v=>v!=null);
  
  if(linhaCompleta && colunaCompleta){
    if(linha===rowTargets[r] && coluna===colTargets[c]) cell.style.background='#A5D6A7'; // verde
    else cell.style.background='#EF9A9A'; // vermelho
  } else {
    cell.style.background='white';
  }
}

// Cria paleta
function criarPaleta(){
  palette.innerHTML='';
  for(let i=1;i<=9;i++){
    const n = document.createElement('div');
    n.className='number';
    n.textContent=i;
    n.onclick = ()=>{
      selectedNumber=i;
      document.querySelectorAll('.number').forEach(el=>el.style.background='#80ff00');
      n.style.background='#32e625';
    };
    palette.appendChild(n);
  }
}

// Verifica solu√ß√£o
function verificar(){
  let ok=true;
  for(let r=0;r<3;r++){
    const soma=board[r].reduce((a,b)=>a+(b||0),0);
    if(soma!==rowTargets[r]) ok=false;
  }
  for(let c=0;c<3;c++){
    const soma=board[0][c]+board[1][c]+board[2][c];
    if(soma!==colTargets[c]) ok=false;
  }
  if(ok){
    clearInterval(intervalo);
    message.textContent = "‚úÖ Correto! Parab√©ns!";
    if(jogoAtivo){
      jogoAtivo = false;
      if(!recorde || tempo < tempoToSegundos(recorde)){
        recorde = tempoEl.textContent;
        localStorage.setItem('recordeGondol', recorde);
        recordeEl.textContent = recorde;
        message.textContent += " üèÜ Novo recorde!";
      }
    }
  } else {
    message.textContent = "‚ùå Ainda n√£o. Continue tentando!";
  }
}

// Converte tempo mm:ss em segundos
function tempoToSegundos(t){
  const [min, seg] = t.split(':').map(Number);
  return min*60 + seg;
}

function novoDesafio(){ gerarTabuleiro(); }

criarPaleta();
novoDesafio();

// üéµ M√∫sica retr√¥ estilo Pac-Man üéÆ
let contexto = new (window.AudioContext || window.webkitAudioContext)();

function tocarNota(freq, duracao) {
  let o = contexto.createOscillator();
  let g = contexto.createGain();
  o.connect(g);
  g.connect(contexto.destination);
  o.type = "square"; // som retr√¥
  o.frequency.value = freq;
  g.gain.setValueAtTime(0.05, contexto.currentTime);
  o.start();
  o.stop(contexto.currentTime + duracao);
}

function musicaFundo() {
  const notas = [440, 660, 880, 660, 550, 740, 550, 440];
  let tempo = 0;
  notas.forEach(freq => {
    setTimeout(()=>tocarNota(freq, 0.15), tempo);
    tempo += 200;
  });
  setTimeout(musicaFundo, 1600); // repete loop
}

document.body.addEventListener('click', () => {
  if (contexto.state === 'suspended') contexto.resume();
  musicaFundo();
}, { once:true });
</script>

</body>
</html>
